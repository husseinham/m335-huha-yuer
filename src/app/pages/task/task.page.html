<ion-header>
  <ion-toolbar>
    <ion-title>{{ hunt.getTask(key).title }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <p>{{ hunt.getTask(key).subtitle }}</p>

  <ng-container *ngIf="key === 'power'">
    <ion-card class="ion-margin-top">
      <ion-card-content>
        <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
          <div>
            <div style="font-weight:600;">Akkustand</div>
            <div style="opacity:.85; font-size:0.95em;">
              <span *ngIf="isCharging">✅ Lädt / verbunden</span>
              <span *ngIf="!isCharging">❌ Nicht verbunden</span>
            </div>
          </div>

          <div style="font-weight:700; font-size:1.1em;">
            {{ batteryPercentText }}
          </div>
        </div>

        <ion-progress-bar
          class="ion-margin-top"
          [value]="batteryLevel ?? 0"
        ></ion-progress-bar>

        <div class="ion-margin-top" style="opacity:.85; font-size:0.95em;">
          Stecke das Ladekabel ein. Danach kannst du die Aufgabe abschliessen.
        </div>
      </ion-card-content>
    </ion-card>
  </ng-container>

  <ng-container *ngIf="key === 'qr'">
    <ion-card class="ion-margin-top">
      <ion-card-content>
        <div style="font-weight:600;">QR-Code scannen</div>
        <div class="ion-margin-bottom" style="opacity:.85; font-size:0.95em;">
          Scanne den QR-Code mit der Kamera. Danach kannst du die Aufgabe abschliessen.
        </div>

        <ion-button expand="block" (click)="scanQr()" [disabled]="qrScanning">
          <ion-spinner
            *ngIf="qrScanning"
            name="dots"
            class="ion-margin-end"
          ></ion-spinner>
          QR-Code scannen
        </ion-button>

        <ion-item class="ion-margin-top">
          <ion-label>
            <div style="font-weight:600;">Ergebnis</div>
            <div style="opacity:.85;">
              {{ qrValue ?? 'Noch kein Code gescannt.' }}
            </div>
          </ion-label>
        </ion-item>

        <ion-button
          *ngIf="qrValue"
          expand="block"
          fill="outline"
          class="ion-margin-top"
          (click)="clearQr()"
        >
          Ergebnis löschen
        </ion-button>
      </ion-card-content>
    </ion-card>
  </ng-container>

  <ion-button expand="block" (click)="markDone()" [disabled]="!canComplete">
    Aufgabe erledigt
  </ion-button>

  <ion-button expand="block" fill="outline" (click)="skip()">
    Aufgabe überspringen
  </ion-button>

  <ion-button expand="block" color="danger" fill="outline" (click)="abort()">
    Durchlauf abbrechen
  </ion-button>
</ion-content>
